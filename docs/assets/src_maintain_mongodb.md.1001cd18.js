import{_ as s,c as a,o,V as n}from"./chunks/framework.ba5de448.js";const F=JSON.parse('{"title":"mongodb","description":"","frontmatter":{},"headers":[],"relativePath":"src/maintain/mongodb.md","filePath":"src/maintain/mongodb.md"}'),l={name:"src/maintain/mongodb.md"},p=n(`<h1 id="mongodb" tabindex="-1">mongodb <a class="header-anchor" href="#mongodb" aria-label="Permalink to &quot;mongodb&quot;">​</a></h1><h2 id="准备" tabindex="-1">准备 <a class="header-anchor" href="#准备" aria-label="Permalink to &quot;准备&quot;">​</a></h2><p>加入 mongodb 仓库信息</p><div class="language-toml"><button title="Copy Code" class="copy"></button><span class="lang">toml</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;"># /etc/yum.repos.d/mongodb-org-6.0.repo</span></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#FFCB6B;">mongodb-org-6</span><span style="color:#A6ACCD;">.</span><span style="color:#FFCB6B;">0</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#A6ACCD;">name</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">MongoDB Repository</span></span>
<span class="line"><span style="color:#A6ACCD;">baseurl</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">https://repo.mongodb.org/yum/redhat/8/mongodb-org/6.0/x86_64/</span></span>
<span class="line"><span style="color:#A6ACCD;">gpgcheck</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">1</span></span>
<span class="line"><span style="color:#A6ACCD;">enabled</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">1</span></span>
<span class="line"><span style="color:#A6ACCD;">gpgkey</span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;">https://www.mongodb.org/static/pgp/server-6.0.asc</span></span></code></pre></div><h2 id="安装" tabindex="-1">安装 <a class="header-anchor" href="#安装" aria-label="Permalink to &quot;安装&quot;">​</a></h2><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">dnf</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">install</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">mongodb-org</span></span></code></pre></div><h2 id="配置" tabindex="-1">配置 <a class="header-anchor" href="#配置" aria-label="Permalink to &quot;配置&quot;">​</a></h2><p>默认配置文件 <code>/etc/mongo.conf</code></p><h3 id="远程连接" tabindex="-1">远程连接 <a class="header-anchor" href="#远程连接" aria-label="Permalink to &quot;远程连接&quot;">​</a></h3><ol><li>修改 <code>mongo.conf</code> 文件</li></ol><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">sudo</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">vi</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/etc/mongo.conf</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 将原来 bindIp:127.0.0.1 修改为 0.0.0.0</span></span></code></pre></div><blockquote><p>mongodb 的配置文件中的 bind_ip 默认为 127.0.0.1，默认只有本机可以连接。 此时，需要将 bind_ip 配置为 0.0.0.0，表示接受任何 IP 的连接</p></blockquote><ol start="2"><li><p>重启动 mongo 服务：<code>systemctl mongod restart</code></p></li><li><p>如果其他主机连不上需要检查防火墙配置, 具体见各发行版的配置</p></li></ol><h2 id="用户管理" tabindex="-1">用户管理 <a class="header-anchor" href="#用户管理" aria-label="Permalink to &quot;用户管理&quot;">​</a></h2><blockquote><p>执行命令都需要先切到某个数据库</p></blockquote><p><code>show users</code> 显示数据库下的用户</p><p><code>db.dropUser(&quot;用户名&quot;)</code> 删除用户</p><p><code>db.updateUser(&quot;用户名&quot;, {pwd: 密码, 等要修改的内容...})</code> 更新用户</p><p><code>db.auth(&quot;用户名&quot;, &quot;密码&quot;)</code> 用户登录</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// 1.切换到admin库, 不同的用户对应不同的库</span></span>
<span class="line"><span style="color:#A6ACCD;">use admin</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// 2.创建账户</span></span>
<span class="line"><span style="color:#A6ACCD;">db</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">createUser</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">user</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">admin</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">pwd</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">zero1024</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">roles</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> [</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">role</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">root</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">//root必须在admin库下</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">db</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">admin</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">]</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// 3.通过配置文件(/etc/mongod.conf), 启用账户管理</span></span>
<span class="line"><span style="color:#FFCB6B;">security</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#FFCB6B;">authorization</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> enabled</span></span></code></pre></div><p>role</p><ul><li>root</li><li>dbOwner</li></ul><h2 id="备份-还原" tabindex="-1">备份&amp;还原 <a class="header-anchor" href="#备份-还原" aria-label="Permalink to &quot;备份&amp;还原&quot;">​</a></h2><h3 id="备份" tabindex="-1">备份 <a class="header-anchor" href="#备份" aria-label="Permalink to &quot;备份&quot;">​</a></h3><p>语法: <code>mongodump [options]</code></p><ul><li><code>-h 服务器地址</code></li><li><code>--port 端口</code></li><li><code>-d 要备份的数据库名称</code></li><li><code> -o 存放备份的路径</code></li><li><code>--authenticationDatabase=验证用户的数据库</code></li><li><code>-u 账号</code></li><li><code>-p</code> 密码</li><li><code>--gzip</code> 用 gzip 压缩</li><li><code>--archive=打包名称</code> 使用 tar 进行打包</li></ul><p>示例</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">mongodump</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--uri=</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">mongodb://用户名:密码!@IP:端口</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-d</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">要备份的数据库</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--authenticationDatabase=验证用户的数据库</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--gzip</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--archive=</span><span style="color:#89DDFF;">&quot;$(</span><span style="color:#FFCB6B;">date</span><span style="color:#C3E88D;"> +%F</span><span style="color:#89DDFF;">)</span><span style="color:#C3E88D;">.gz</span><span style="color:#89DDFF;">&quot;</span></span></code></pre></div><h3 id="还原" tabindex="-1">还原 <a class="header-anchor" href="#还原" aria-label="Permalink to &quot;还原&quot;">​</a></h3><p>语法: <code>mongorestore 选项</code></p><ul><li><code>--drop</code>: 先删除 -d 指定的数据库, 再进行恢复(慎用)</li><li><code>--nsFrom=&quot;数据库.集合(*表示全部)&quot;</code> 指定恢复来源</li><li><code>--nsTo=&quot;数据库.集合(*表示全部)&quot;</code> 指定恢复目标</li></ul><p>示例</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;"># 备份的数据库名称和恢复的数据库名称相同</span></span>
<span class="line"><span style="color:#FFCB6B;">mongorestore</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--uri=</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">mongodb://IP:端口</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-d</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">数据库名称</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--gzip</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--archive=备份文件</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 备份的数据库名称和恢复的数据库名称不同</span></span>
<span class="line"><span style="color:#FFCB6B;">mongorestore</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--uri=</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">mongodb://IP:端口</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--gzip</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--archive=备份文件</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--nsFrom=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">备份的数据库.*</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--nsTo=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">恢复的数据库.*</span><span style="color:#89DDFF;">&quot;</span></span></code></pre></div>`,33),e=[p];function t(c,r,i,y,D,d){return o(),a("div",null,e)}const A=s(l,[["render",t]]);export{F as __pageData,A as default};
